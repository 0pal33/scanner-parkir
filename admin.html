<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Wayahe Parkir</title>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

</head>

<body style="text-align:center;font-family:sans-serif">

<h2>Dashboard Admin</h2>

<p id="role"></p>

<h3>Laporan Hari Ini</h3>
<p>Checkout: <span id="count">0</span></p>
<p>Total: Rp <span id="total">0</span></p>

<div id="menu"></div>

<button onclick="logout()">Logout</button>

<script>

const firebaseConfig = {
  apiKey: "AIzaSyCbB2eqYAxCM1DvkSyCyoqKwq39mvCBwCQ",
  authDomain: "parkir-demo.firebaseapp.com",
  projectId: "parkir-demo",
  storageBucket: "parkir-demo.firebasestorage.app",
  messagingSenderId: "962001897575",
  appId: "1:962001897575:web:811c1902e3a274f7bb6cc2"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// WIB DATE
function getWIBDate(){
let now = new Date();
let wib = new Date(now.toLocaleString("en-US",{timeZone:"Asia/Jakarta"}));
return `${wib.getFullYear()}-${wib.getMonth()+1}-${wib.getDate()}`;
}

// ROLE EMAIL
const ownerEmail = "afrupradana2@gmail.com";
const editorEmail = "fakha3161@gmail.com";

firebase.auth().onAuthStateChanged(user=>{
if(!user){
window.location.href="/";
return;
}

let role = "viewer";

if(user.email == ownerEmail){ role = "owner"; }
if(user.email == editorEmail){ role = "editor"; }

document.getElementById("role").innerHTML = "Role: " + role;

loadReport();

if(role == "owner" || role == "editor"){
document.getElementById("menu").innerHTML =
`<button onclick="editTarif()">Edit Tarif</button>`;
}else{
document.getElementById("menu").innerHTML =
`<p>Akses hanya melihat</p>`;
}

});

// LOAD REPORT
function loadReport(){

let today = getWIBDate();

db.collection("checkout")
.where("tanggal","==",today)
.get()
.then(snapshot=>{

let count = snapshot.size;
let total = 0;

snapshot.forEach(doc=>{
total += doc.data().bayar;
});

document.getElementById("count").innerHTML = count;
document.getElementById("total").innerHTML = total.toLocaleString("id-ID");

});

}

function editTarif(){
alert("Fitur edit tarif akan dibuat selanjutnya");
}

function logout(){
firebase.auth().signOut();
window.location.href="/";
}

</script>

</body>
</html>
